<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Model Settings | TechVyro</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: linear-gradient(135deg, #020617, #0f172a);
      color: #e5e7eb;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 40px auto;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    h1 { font-size: 28px; margin-bottom: 10px; }
    .subtitle { color: #9aa0b4; margin-bottom: 30px; }

    .section { margin-bottom: 30px; }
    .section h2 { font-size: 18px; margin-bottom: 15px; color: #38bdf8; }

    .model-card {
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 15px;
      cursor: pointer;
      transition: all 0.25s ease;
    }

    .model-card:hover {
      background: rgba(30, 41, 59, 0.9);
      border-color: rgba(59, 130, 246, 0.6);
      transform: translateX(4px);
    }

    .model-card input[type="radio"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .model-info { flex: 1; }
    .model-info .name { font-weight: 700; font-size: 16px; margin-bottom: 4px; }
    .model-info .desc { font-size: 14px; color: #9aa0b4; }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      color: #020617;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
    }

    .status {
      padding: 15px;
      background: rgba(56, 189, 248, 0.1);
      border-radius: 10px;
      border-left: 3px solid #38bdf8;
      margin-bottom: 20px;
    }

    .status strong { color: #38bdf8; }

    button {
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.25s ease;
    }

    button:hover { transform: translateY(-2px); box-shadow: 0 15px 40px rgba(56, 189, 248, 0.35); }
    button:disabled { opacity: 0.6; cursor: not-allowed; }

    .footer { margin-top: 30px; text-align: center; color: #9aa0b4; font-size: 14px; }
  </style>
<script type="module" src="./js/auth-guard.js"></script>
</head>
<body>
  <div class="container">
    <h1>AI Model Selection</h1>
    <p class="subtitle">Choose your preferred AI model for better performance</p>

    <div class="section">
      <div class="status">
        <strong id="statusMsg">Loading configuration...</strong>
      </div>
    </div>

    <div class="section">
      <h2>Available Models</h2>
      <form id="modelForm">
        <div id="modelsContainer">
          <p style="color: #9aa0b4;">Loading available models...</p>
        </div>
      </form>
    </div>

    <div class="section">
      <button onclick="saveSelection()">Save Preference</button>
      <button onclick="loadDefault()" style="background: rgba(59, 130, 246, 0.2); color: #38bdf8; margin-left: 10px;">Reset to Default</button>
    </div>

    <div class="footer">
      <p>Configuration is stored locally in your browser. Changes take effect immediately.</p>
    </div>
  </div>

  <script type="module">
    import { loadConfig, getAIModels, getDefaultAIModel, isClaudeHaiku45Enabled } from '../js/config-loader.js';

    async function initPage() {
      try {
        await loadConfig();
        const models = getAIModels();
        const defaultModel = getDefaultAIModel();
        const haiku45Enabled = isClaudeHaiku45Enabled();

        // Update status
        const statusEl = document.getElementById('statusMsg');
        statusEl.textContent = haiku45Enabled
          ? 'Claude Haiku 4.5 is enabled for all clients âœ“'
          : 'Claude Haiku 4.5 is available for premium users';

        // Render model cards
        const container = document.getElementById('modelsContainer');
        container.innerHTML = models
          .map(model => `
            <label class="model-card">
              <input
                type="radio"
                name="aiModel"
                value="${model.id}"
                ${model.id === defaultModel ? 'checked' : ''}
                ${!model.enabled ? 'disabled' : ''}
              />
              <div class="model-info">
                <div class="name">
                  ${model.name}
                  ${model.id === 'claude-haiku-4.5' && haiku45Enabled ? '<span class="badge">Default</span>' : ''}
                </div>
                <div class="desc">${model.description}</div>
              </div>
            </label>
          `)
          .join('');
      } catch (err) {
        console.error('Error initializing:', err);
        document.getElementById('statusMsg').textContent = 'Error loading configuration';
      }
    }

    window.saveSelection = function() {
      const selected = document.querySelector('input[name="aiModel"]:checked');
      if (selected) {
        localStorage.setItem('preferred_ai_model', selected.value);
        alert('Preference saved: ' + selected.value);
      }
    };

    window.loadDefault = function() {
      const form = document.getElementById('modelForm');
      const defaultRadio = form.querySelector('input[value="claude-haiku-4.5"]');
      if (defaultRadio) defaultRadio.checked = true;
      localStorage.removeItem('preferred_ai_model');
      alert('Reset to default: Claude Haiku 4.5');
    };

    initPage();
  </script>
</body>
</html>
