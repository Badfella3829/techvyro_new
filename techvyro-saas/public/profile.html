<!DOCTYPE html>
<html>
<head>
  <title>My Profile | TechVyro</title>

  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    }

    body {
      margin: 0;
      background: #0f172a;
      color: #020617;
      padding: 30px;
    }

    /* ===== PAGE LOADER ===== */
    #pageLoader {
      position: fixed;
      inset: 0;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .spinner {
      width: 46px;
      height: 46px;
      border: 4px solid #334155;
      border-top: 4px solid #38bdf8;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ===== FADE IN PAGE ===== */
    .page {
      opacity: 0;
      transform: translateY(6px);
      animation: fadeIn .5s ease forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: none;
      }
    }

    .card {
      background: #ffffff;
      max-width: 500px;
      margin: auto;
      padding: 28px;
      border-radius: 18px;
      box-shadow: 0 20px 50px rgba(0,0,0,.15);
    }

    h2 {
      margin-top: 0;
      font-size: 22px;
      font-weight: 800;
    }

    p {
      font-size: 14px;
      margin-bottom: 12px;
      font-weight: 600;
    }

    a {
      color: #4f46e5;
      font-weight: 700;
      text-decoration: none;
    }

    button {
      margin-top: 18px;
      padding: 12px 16px;
      background: linear-gradient(135deg,#6366f1,#4f46e5);
      color: #fff;
      border: none;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
    }

    /* ===== üî• PREMIUM SOCIAL ICONS (ADDED SAFE) ===== */
    .profile-social {
      margin-top: 26px;
      display: flex;
      justify-content: center;
      gap: 16px;
    }

    .profile-social a {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 26px rgba(56,189,248,.35);
      transition: all .25s ease;
    }

    .profile-social a:hover {
      transform: translateY(-3px);
      box-shadow: 0 18px 40px rgba(56,189,248,.55);
    }

    .profile-social svg {
      width: 18px;
      height: 18px;
      fill: #38bdf8;
    }

    /* ================= üî• ADDED: PLAN BADGE STYLES ================= */
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 800;
      margin-left: 6px;
    }
    .badge.free { background:#e5e7eb; color:#020617; }
    .badge.premium { background:#fde68a; color:#92400e; }
    .badge.admin { background:#c7d2fe; color:#1e3a8a; }
    /* ================= END ADD ================= */
  </style>
<script type="module" src="./js/auth-guard.js"></script>
</head>

<body>

<!-- PAGE LOADER -->
<div id="pageLoader">
  <div class="spinner"></div>
</div>

<!-- PAGE WRAP -->
<div class="page">

  <div class="card">

    <h2>
      My Profile
      <!-- üî• ADDED: PLAN BADGE -->
      <span id="planBadge" class="badge free">FREE</span>
    </h2>

    <p><strong>Email:</strong> <span id="email">Loading...</span></p>
    <p><strong>User ID:</strong> <span id="uid">Loading...</span></p>

    <!-- üî• ADDED: ROLE INFO -->
    <p><strong>Role:</strong> <span id="role">user</span></p>

    <hr>

    <a href="dashboard.html">‚Üê Go to Dashboard</a>

    <br><br>

    <!-- ORIGINAL BUTTON (UNCHANGED UI) -->
    <button id="logoutBtn" onclick="logout()">Logout</button>

    <!-- üî• ADDED PREMIUM SOCIAL ICONS -->
    <div class="profile-social">

      <!-- Instagram -->
      <a href="https://instagram.com/techvyro" target="_blank">
        <svg viewBox="0 0 24 24">
          <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zM12 7.5A4.5 4.5 0 1 0 16.5 12 4.5 4.5 0 0 0 12 7.5zM18 5.6a1.1 1.1 0 1 0 1.1 1.1A1.1 1.1 0 0 0 18 5.6z"/>
        </svg>
      </a>

      <!-- Telegram -->
      <a href="https://t.me/techvyro" target="_blank">
        <svg viewBox="0 0 24 24">
          <path d="M21.9 2.6 2.8 10.3c-1.3.5-1.3 1.2-.2 1.6l4.9 1.5 1.9 5.6c.2.6.4.8.9.8.3 0 .6-.2.9-.5l2.3-2.2 4.8 3.5c.9.5 1.5.2 1.7-.8l3.2-15c.3-1.2-.5-1.7-1.3-1.4z"/>
        </svg>
      </a>

      <!-- YouTube -->
      <a href="https://youtube.com/@techvyro" target="_blank">
        <svg viewBox="0 0 24 24">
          <path d="M23.5 6.2s-.2-1.7-.9-2.4c-.9-.9-1.9-.9-2.4-1C16.8 2.5 12 2.5 12 2.5s-4.8 0-8.2.3c-.5.1-1.5.1-2.4 1-.7.7-.9 2.4-.9 2.4S.2 8.1.2 10v1.9c0 1.9.3 3.8.3 3.8s.2 1.7.9 2.4c.9.9 2.1.9 2.6 1 1.9.2 8 .3 8 .3s4.8 0 8.2-.3c.5-.1 1.5-.1 2.4-1 .7-.7.9-2.4.9-2.4s.3-1.9.3-3.8V10c0-1.9-.3-3.8-.3-3.8zM9.8 13.9V7.8l5.7 3.1-5.7 3z"/>
        </svg>
      </a>

    </div>

  </div>

</div>

<!-- ORIGINAL LOGIC FILE (UNTOUCHED) -->
<script type="module" src="../js/profile.js"></script>

<script>
  window.addEventListener("load", () => {
    document.getElementById("pageLoader").style.display = "none";
  });
</script>

<!-- ================= STEP-6 ADD START (SESSION SYNC + BADGE LOGIC) ================= -->
<script>
  const sessionUser = JSON.parse(localStorage.getItem("user"));
  if (sessionUser) {
    document.getElementById("role").innerText = sessionUser.role || "user";

    const badge = document.getElementById("planBadge");
    if (sessionUser.isPremium) {
      badge.innerText = "PREMIUM";
      badge.className = "badge premium";
    }
    if (sessionUser.role !== "user") {
      badge.innerText = sessionUser.role.toUpperCase();
      badge.className = "badge admin";
    }
  }
</script>
<!-- ================= STEP-6 ADD END ================= -->

<!-- ================= STEP-5 ADD START (SECURITY HARDENING) ================= -->
<script type="module">
  import { auth } from "../js/firebase.js";
  import { signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  auth.onAuthStateChanged(user => {
    if (!user) {
      location.href = "login.html";
    }
  });

  const logoutBtn = document.getElementById("logoutBtn");
  if (logoutBtn) {
    logoutBtn.onclick = async () => {
      await signOut(auth);
      localStorage.removeItem("user"); // üî• added safe cleanup
      location.href = "login.html";
    };
  }
</script>
<!-- ================= STEP-5 ADD END ================= -->

</body>
</html>
